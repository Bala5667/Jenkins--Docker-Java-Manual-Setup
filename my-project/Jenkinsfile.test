pipeline {
    agent any

    stages {
        stage('Test') {
            steps {
                script {
                    // Run the container
                    sh 'docker run -d --name java-web-app-test -p 8080:8080 java-web-app'
                    
                    // Wait for app to start
                    sleep 5

                    // Check if application is running
                    def response = sh(script: "curl -s -o /dev/null -w '%{http_code}' http://localhost:8080", returnStdout: true).trim()

                    if (response == '200') {
                        echo "✅ Test Passed: App is running successfully!"
                    } else {
                        error("❌ Test Failed: Got HTTP status ${response}")
                    }

                    // Cleanup
                    sh 'docker stop java-web-app-test'
                    sh 'docker rm java-web-app-test'
                }
            }
        }
    }
}
